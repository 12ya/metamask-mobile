name: Bitrise E2E

on:
  pull_request:
    types: [labeled]

jobs:
  deploy:
    name: Run e2e smoke test on Bitrise
    runs-on: ubuntu-latest
    steps:
      - name: Start pr_smoke_e2e_pipeline workflow in Bitrise
        if: contains(github.event.pull_request.labels.*.name, 'needs-smoke-e2e')
        run: |
          curl https://app.bitrise.io/app/${{ secrets.BITRISE_APP_ID }}/build/start.json -L -H 'Content-Type: application/json' --data '{
            "hook_info": {
              "type": "bitrise",
              "build_trigger_token": "${{ secrets.BITRISE_BUILD_TRIGGER_TOKEN }}"
            },
            "build_params": {
              "branch": "${{ github.head_ref }}",
              "pipeline_id": "pr_smoke_e2e_pipeline",
            },
            "triggered_by": "curl"
          }'
