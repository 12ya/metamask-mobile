name: Create E2E tag for PR

on:
  pull_request:
    types: [labeled]

jobs:
  create-pr-e2e-tag:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version-file: '.nvmrc'
          cache: yarn

      - name: Install Axios
        run: yarn add axios

      - name: Install dependencies
        run: yarn --immutable

      - name: Create E2E tag for PR
        env:
          BITRISE_BUILD_TRIGGER_TOKEN: ${{ secrets.BITRISE_BUILD_TRIGGER_TOKEN }}
          BITRISE_APP_ID: ${{ secrets.BITRISE_APP_ID }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: yarn run create-pr-e2e-tag
# name: Bitrise E2E

# on:
#   pull_request:
#     types: [labeled]

# jobs:
#   deploy:
#     name: Run e2e smoke test on Bitrise
#     runs-on: ubuntu-latest
#     steps:
#       - name: Start pr_smoke_e2e_pipeline workflow in Bitrise
#         if: contains(github.event.pull_request.labels.*.name, 'Run E2E')
#         run: |
#           curl https://app.bitrise.io/app/${{ secrets.BITRISE_APP_ID }}/build/start.json -L -H 'Content-Type: application/json' --data '{
#             "hook_info": {
#               "type": "bitrise",
#               "build_trigger_token": "${{ secrets.BITRISE_BUILD_TRIGGER_TOKEN }}"
#             },
#             "build_params": {
#               "branch": "${{ github.head_ref }}",
#               "pipeline_id": "pr_smoke_e2e_pipeline"
#             },
#             "triggered_by": "curl"
#           }'
