format_version: 1.1.0
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

title: Template configuration.
summary: |-
  Template 'bitrise.yml', generated by 'bitrise init'.
description: |-
  app:
  envs:
  - BITRISE_APP_TITLE: "MyApp"
  - BITRISE_DEV_BRANCH: "develop"

trigger_map:
- pattern: test**
  is_pull_request_allowed: true
  workflow: test
- pattern: "*"
  is_pull_request_allowed: true
  workflow: fallback

workflows:
  test:
    steps:
    - script:
        title: Hello Bitrise!
        inputs:
        - content: |-
            #!/bin/bash
            envman add --key MY_KEY --value true
            envman add --key USE_MAIN_CACHE --value true
            echo "Welcome to Bitrise!"
            echo "Such Test!"
            echo
            echo "Project Title is: ${BITRISE_APP_TITLE}"
            echo "and the primary development branch is: ${BITRISE_DEV_BRANCH}"
    - script:
        title: 22222222!
        inputs:
        - content: |-
            #!/bin/bash
            echo "MY KEY is: ${MY_KEY}"
    - save-cache@1:
          title: 33333333!
          run_if: true
          inputs:
          # - key: 'ios-ccache-{{ .MY_KEY }}main{{ else }}{{ checksum "ios-diff.txt"}}{{ end }}'
          - key: 'ios-ccache-{{if getenv "USE_MAIN_CACHE" }}main{{else}}{{ checksum "ios-diff.txt"}}'
          - paths: |-
              ios-diff.txt
  fallback:
    steps:
    - script:
        title: Fallback
        inputs:
        - content: |-
            #!/bin/bash
            echo "Such Fallback!"